<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="t_order_info_shop">
  <resultMap class="app.cn.qtt.bm.model.TOrderInfoShop" id="abatorgenerated_TOrderInfoShopResult">
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Sep 17 11:21:55 CST 2013.
    -->
    <result column="order_shop_id" jdbcType="INTEGER" property="orderShopId" />
    <result column="order_id" jdbcType="INTEGER" property="orderId" />
    <result column="shop_id" jdbcType="INTEGER" property="shopId" />
    <result column="order_shop_qrcode" jdbcType="VARCHAR" property="orderShopQrcode" />
    <result column="create_user_code" jdbcType="VARCHAR" property="createUserCode" />
    <result column="modify_user_code" jdbcType="VARCHAR" property="modifyUserCode" />
    <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
    <result column="modify_time" jdbcType="TIMESTAMP" property="modifyTime" />
    <result column="order_shop_run_status" jdbcType="VARCHAR" property="orderShopRunStatus" />
    <result column="price" jdbcType="VARCHAR" property="price" />
    <result column="captchas" jdbcType="VARCHAR" property="captchas" />
    <result column="shop_id" property="shopInfo" select="t_shop_info.selectByShopId" />
  </resultMap>
  <sql id="abatorgenerated_Example_Where_Clause">
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Sep 17 11:21:55 CST 2013.
    -->
    <iterate conjunction="or" prepend="where" property="oredCriteria" removeFirstPrepend="iterate">
      <isEqual compareValue="true" property="oredCriteria[].valid">
        (
        <iterate conjunction="and" prepend="and" property="oredCriteria[].criteriaWithoutValue">
          $oredCriteria[].criteriaWithoutValue[]$
        </iterate>
        <iterate conjunction="and" prepend="and" property="oredCriteria[].criteriaWithSingleValue">
          $oredCriteria[].criteriaWithSingleValue[].condition$
            #oredCriteria[].criteriaWithSingleValue[].value#
        </iterate>
        <iterate conjunction="and" prepend="and" property="oredCriteria[].criteriaWithListValue">
          $oredCriteria[].criteriaWithListValue[].condition$
          <iterate close=")" conjunction="," open="(" property="oredCriteria[].criteriaWithListValue[].values">
            #oredCriteria[].criteriaWithListValue[].values[]#
          </iterate>
        </iterate>
        <iterate conjunction="and" prepend="and" property="oredCriteria[].criteriaWithBetweenValue">
          $oredCriteria[].criteriaWithBetweenValue[].condition$
          #oredCriteria[].criteriaWithBetweenValue[].values[0]# and
          #oredCriteria[].criteriaWithBetweenValue[].values[1]#
        </iterate>
        )
      </isEqual>
    </iterate>
  </sql>
  <select id="abatorgenerated_selectByPrimaryKey" parameterClass="app.cn.qtt.bm.model.TOrderInfoShop" resultMap="abatorgenerated_TOrderInfoShopResult">
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Sep 17 11:21:55 CST 2013.
    -->
    select order_shop_id, order_id, shop_id, order_shop_qrcode, create_user_code, modify_user_code,
      create_time, modify_time, order_shop_run_status, price, captchas
    from t_order_info_shop
    where order_shop_id = #orderShopId:INTEGER#
  </select>
  <select id="abatorgenerated_selectByExample" parameterClass="app.cn.qtt.bm.model.TOrderInfoShopExample" resultMap="abatorgenerated_TOrderInfoShopResult">
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Sep 17 11:21:55 CST 2013.
    -->
    select order_shop_id, order_id, shop_id, order_shop_qrcode, create_user_code, modify_user_code,
      create_time, modify_time, order_shop_run_status, price, captchas
    from t_order_info_shop
    <isParameterPresent>
      <include refid="t_order_info_shop.abatorgenerated_Example_Where_Clause" />
      <isNotNull property="orderByClause">
        order by $orderByClause$
      </isNotNull>
    </isParameterPresent>
  </select>
  <delete id="abatorgenerated_deleteByPrimaryKey" parameterClass="app.cn.qtt.bm.model.TOrderInfoShop">
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Sep 17 11:21:55 CST 2013.
    -->
    delete from t_order_info_shop
    where order_shop_id = #orderShopId:INTEGER#
  </delete>
  <delete id="abatorgenerated_deleteByExample" parameterClass="app.cn.qtt.bm.model.TOrderInfoShopExample">
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Sep 17 11:21:55 CST 2013.
    -->
    delete from t_order_info_shop
    <include refid="t_order_info_shop.abatorgenerated_Example_Where_Clause" />
  </delete>
  <insert id="abatorgenerated_insert" parameterClass="app.cn.qtt.bm.model.TOrderInfoShop">
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Sep 17 11:21:55 CST 2013.
    -->
    insert into t_order_info_shop (order_shop_id, order_id, shop_id, order_shop_qrcode,
      create_user_code, modify_user_code, create_time, modify_time, order_shop_run_status, price,
      captchas)
    values (#orderShopId:INTEGER#, #orderId:INTEGER#, #shopId:INTEGER#, #orderShopQrcode:VARCHAR#,
      #createUserCode:VARCHAR#, #modifyUserCode:VARCHAR#, #createTime:TIMESTAMP#,
      #modifyTime:TIMESTAMP#, #orderShopRunStatus:VARCHAR#, #price:VARCHAR#, #captchas:VARCHAR#)
  </insert>
  <update id="abatorgenerated_updateByPrimaryKey" parameterClass="app.cn.qtt.bm.model.TOrderInfoShop">
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Sep 17 11:21:55 CST 2013.
    -->
    update t_order_info_shop
    set order_id = #orderId:INTEGER#,
      shop_id = #shopId:INTEGER#,
      order_shop_qrcode = #orderShopQrcode:VARCHAR#,
      create_user_code = #createUserCode:VARCHAR#,
      modify_user_code = #modifyUserCode:VARCHAR#,
      create_time = #createTime:TIMESTAMP#,
      modify_time = #modifyTime:TIMESTAMP#,
      order_shop_run_status = #orderShopRunStatus:VARCHAR#,
      price = #price:VARCHAR#,
      captchas = #captchas:VARCHAR#
    where order_shop_id = #orderShopId:INTEGER#
  </update>
  <update id="abatorgenerated_updateByPrimaryKeySelective" parameterClass="app.cn.qtt.bm.model.TOrderInfoShop">
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Sep 17 11:21:55 CST 2013.
    -->
    update t_order_info_shop
    <dynamic prepend="set">
      <isNotNull prepend="," property="orderId">
        order_id = #orderId:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="shopId">
        shop_id = #shopId:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="orderShopQrcode">
        order_shop_qrcode = #orderShopQrcode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="createUserCode">
        create_user_code = #createUserCode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="modifyUserCode">
        modify_user_code = #modifyUserCode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="createTime">
        create_time = #createTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="modifyTime">
        modify_time = #modifyTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="orderShopRunStatus">
        order_shop_run_status = #orderShopRunStatus:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="price">
        price = #price:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="captchas">
        captchas = #captchas:VARCHAR#
      </isNotNull>
    </dynamic>
    where order_shop_id = #orderShopId:INTEGER#
  </update>
  <select id="abatorgenerated_countByExample" parameterClass="app.cn.qtt.bm.model.TOrderInfoShopExample" resultClass="java.lang.Integer">
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Sep 17 11:21:55 CST 2013.
    -->
    select count(*) from t_order_info_shop
    <include refid="t_order_info_shop.abatorgenerated_Example_Where_Clause" />
  </select>
  <update id="abatorgenerated_updateByExampleSelective">
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Sep 17 11:21:55 CST 2013.
    -->
    update t_order_info_shop
    <dynamic prepend="set">
      <isNotNull prepend="," property="record.orderShopId">
        order_shop_id = #record.orderShopId:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="record.orderId">
        order_id = #record.orderId:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="record.shopId">
        shop_id = #record.shopId:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="record.orderShopQrcode">
        order_shop_qrcode = #record.orderShopQrcode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.createUserCode">
        create_user_code = #record.createUserCode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.modifyUserCode">
        modify_user_code = #record.modifyUserCode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.createTime">
        create_time = #record.createTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="record.modifyTime">
        modify_time = #record.modifyTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="record.orderShopRunStatus">
        order_shop_run_status = #record.orderShopRunStatus:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.price">
        price = #record.price:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.captchas">
        captchas = #record.captchas:VARCHAR#
      </isNotNull>
    </dynamic>
    <isParameterPresent>
      <include refid="t_order_info_shop.abatorgenerated_Example_Where_Clause" />
    </isParameterPresent>
  </update>
  <update id="abatorgenerated_updateByExample">
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Tue Sep 17 11:21:55 CST 2013.
    -->
    update t_order_info_shop
    set order_shop_id = #record.orderShopId:INTEGER#,
      order_id = #record.orderId:INTEGER#,
      shop_id = #record.shopId:INTEGER#,
      order_shop_qrcode = #record.orderShopQrcode:VARCHAR#,
      create_user_code = #record.createUserCode:VARCHAR#,
      modify_user_code = #record.modifyUserCode:VARCHAR#,
      create_time = #record.createTime:TIMESTAMP#,
      modify_time = #record.modifyTime:TIMESTAMP#,
      order_shop_run_status = #record.orderShopRunStatus:VARCHAR#,
      price = #record.price:VARCHAR#,
      captchas = #record.captchas:VARCHAR#
    <isParameterPresent>
      <include refid="t_order_info_shop.abatorgenerated_Example_Where_Clause" />
    </isParameterPresent>
  </update>
  
  <resultMap class="app.cn.qtt.bm.model.CountAndPrice" id="calculatePrice">
  	<result column="price" jdbcType="VARCHAR" property="price" />
  	<result column="count" jdbcType="VARCHAR" property="count" />
  </resultMap>
  
  <resultMap class="app.cn.qtt.bm.model.SmsContext" id="smsContextResult">
  	<result column="shop_name" jdbcType="VARCHAR" property="shopName" />
  	<result column="shop_goods_name" jdbcType="VARCHAR" property="shopGoodsName" />
  	<result column="shop_goods_count" jdbcType="VARCHAR" property="shopGoodsCount" />
  </resultMap>
  <!-- 统计当前商店下的总价 Added by Gabriel 2013-6-26 -->
  <!-- 查询订单详情 Added by Gabriel 2013-6-26 -->
  <select id="selectShopOrderDetail" parameterClass="app.cn.qtt.bm.model.TOrderInfoShop" resultMap="smsContextResult">
  	select t.shop_name,t2.shop_goods_name,sum(t1.shop_goods_count) shop_goods_count
	  from t_order_info_goods t1,t_shop_goods t2,t_shop_info t,t_order_info_shop t3
	 where t2.shop_id = t.shop_id
     and t1.shop_goods_id = t2.shop_goods_id
	   and t1.shop_id = t.shop_id
	   and t3.shop_id = t1.shop_id
	   and t1.order_id = t3.order_id
       and t3.order_shop_run_status = '03'
       and t3.create_time &gt;= date(now())
	   and t.shop_id=#shopId:INTEGER#
	group by t.shop_name,t2.shop_goods_name
  </select>
  <!-- 验证手机后4位和验证码 Added by Gabriel 2013-09-17 -->
  <select id="selectByVerifyCondition" parameterClass="java.util.Map" resultMap="abatorgenerated_TOrderInfoShopResult" >
  	select t.order_shop_id, t.order_id, t.shop_id, t.order_shop_qrcode, t.create_user_code, t.modify_user_code,
      t.create_time, t.modify_time, t.order_shop_run_status, t.price, t.captchas
     from t_order_info_shop t,t_sys_user_info t1
	where t.create_user_code = t1.user_code
	  and TO_DAYS(t.create_time) = TO_DAYS(now())
	  and SUBSTR(t1.user_phone_number FROM 8) = #shortPhoneNumber#
	  and t.order_shop_run_status = '03'
	  and t.captchas = #captchas#
  </select>
  <!-- 统计当前商店下的总价 Added by Gabriel 2013-6-26 -->
  <select id="abatorgenerated_calculatePrice" parameterClass="app.cn.qtt.bm.model.TOrderInfoShop" resultMap="calculatePrice">
    select sum(t1.shop_goods_count*t2.shop_goods_price) price,sum(t1.shop_goods_count) as count
	 from t_order_info_shop t,t_order_info_goods t1,t_shop_goods t2
	where t.order_id = t1.order_id
	  and t.shop_id = t1.shop_id
	  and t2.shop_goods_id = t1.shop_goods_id
	  and t.create_time >= date(now())
	  <isNotNull prepend="and" property="shopId">
	  	t.shop_id=#shopId:INTEGER#
	  </isNotNull>
	  and t.order_id = #orderId:INTEGER#
  </select>
</sqlMap>