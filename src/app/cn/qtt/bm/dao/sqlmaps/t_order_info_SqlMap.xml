<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="t_order_info" >
  <resultMap id="abatorgenerated_TOrderInfoResult" class="app.cn.qtt.bm.model.TOrderInfo" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Sat Jun 08 15:02:10 CST 2013.
    -->
    <result column="order_id" property="orderId" jdbcType="INTEGER" />
    <result column="order_code" property="orderCode" jdbcType="VARCHAR" />
    <result column="order_name" property="orderName" jdbcType="VARCHAR" />
    <result column="order_desc" property="orderDesc" jdbcType="VARCHAR" />
    <result column="order_run_status" property="orderRunStatus" jdbcType="VARCHAR" />
    <result column="order_goods_count" property="orderGoodsCount" jdbcType="VARCHAR" />
    <result column="order_price" property="orderPrice" jdbcType="VARCHAR" />
    <result column="create_user_code" property="createUserCode" jdbcType="VARCHAR" />
    <result column="modify_user_code" property="modifyUserCode" jdbcType="VARCHAR" />
    <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
    <result column="modify_time" property="modifyTime" jdbcType="TIMESTAMP" />
    <result column="order_id" property="orderInfoGoods" select="t_order_info_goods.selectByOrderId" />
    <result column="create_user_code" property="sysUserInfo" select="t_sys_user_info.selectByUserCode" />
  </resultMap>
  <resultMap id="OrderOperateBeanResult" class="app.cn.qtt.bm.model.OrderOperateBean" >
    
    <result column="shop_name" property="shopName" jdbcType="VARCHAR" />
    <result column="shop_goods_name" property="shopGoodsName" jdbcType="VARCHAR" />
    <result column="shop_goods_count" property="shopGoodsCount" jdbcType="INTEGER" />
    <result column="user_name" property="userName" jdbcType="VARCHAR" />
    <result column="create_time" property="createTime" jdbcType="VARCHAR" />
    <result column="modify_time" property="modifyTime" jdbcType="VARCHAR" />
    <result column="paid_status" property="paidStatus" jdbcType="VARCHAR" />
    <result column="operate_times" property="operateTimes" jdbcType="INTEGER" />
     <result column="user_phone_number" property="userPhoneNumber" jdbcType="VARCHAR" />
    <result column="department" property="department" jdbcType="VARCHAR" />
  </resultMap>
  <sql id="abatorgenerated_Example_Where_Clause" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Sat Jun 08 15:02:10 CST 2013.
    -->
    <iterate property="oredCriteria" conjunction="or" prepend="where" removeFirstPrepend="iterate" >
      <isEqual property="oredCriteria[].valid" compareValue="true" >
        (
        <iterate prepend="and" property="oredCriteria[].criteriaWithoutValue" conjunction="and" >
          $oredCriteria[].criteriaWithoutValue[]$
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithSingleValue" conjunction="and" >
          $oredCriteria[].criteriaWithSingleValue[].condition$
            #oredCriteria[].criteriaWithSingleValue[].value#
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithListValue" conjunction="and" >
          $oredCriteria[].criteriaWithListValue[].condition$
          <iterate property="oredCriteria[].criteriaWithListValue[].values" open="(" close=")" conjunction="," >
            #oredCriteria[].criteriaWithListValue[].values[]#
          </iterate>
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithBetweenValue" conjunction="and" >
          $oredCriteria[].criteriaWithBetweenValue[].condition$
          #oredCriteria[].criteriaWithBetweenValue[].values[0]# and
          #oredCriteria[].criteriaWithBetweenValue[].values[1]#
        </iterate>
        )
      </isEqual>
    </iterate>
  </sql>
  <select id="abatorgenerated_selectByPrimaryKey" resultMap="abatorgenerated_TOrderInfoResult" parameterClass="app.cn.qtt.bm.model.TOrderInfo" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Sat Jun 08 15:02:10 CST 2013.
    -->
    select order_id, order_code, order_name, order_desc, order_run_status, order_goods_count,
      order_price, create_user_code, modify_user_code, create_time, modify_time
    from t_order_info
    where order_id = #orderId:INTEGER#
  </select>
  <select id="abatorgenerated_selectByExample" resultMap="abatorgenerated_TOrderInfoResult" parameterClass="app.cn.qtt.bm.model.TOrderInfoExample" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Sat Jun 08 15:02:10 CST 2013.
    -->
    select order_id, order_code, order_name, order_desc, order_run_status, order_goods_count,
      order_price, create_user_code, modify_user_code, create_time, modify_time
    from t_order_info
    <isParameterPresent >
      <include refid="t_order_info.abatorgenerated_Example_Where_Clause" />
      <isNotNull property="orderByClause" >
        order by $orderByClause$
      </isNotNull>
    </isParameterPresent>
  </select>
  <delete id="abatorgenerated_deleteByPrimaryKey" parameterClass="app.cn.qtt.bm.model.TOrderInfo" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Sat Jun 08 15:02:10 CST 2013.
    -->
    delete from t_order_info
    where order_id = #orderId:INTEGER#
  </delete>
  <delete id="abatorgenerated_deleteByExample" parameterClass="app.cn.qtt.bm.model.TOrderInfoExample" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Sat Jun 08 15:02:10 CST 2013.
    -->
    delete from t_order_info
    <include refid="t_order_info.abatorgenerated_Example_Where_Clause" />
  </delete>
  <insert id="abatorgenerated_insert" parameterClass="app.cn.qtt.bm.model.TOrderInfo" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Sat Jun 08 15:02:10 CST 2013.
    -->
    insert into t_order_info (order_id, order_code, order_name, order_desc, order_run_status,
      order_goods_count, order_price, create_user_code, modify_user_code, create_time, modify_time)
    values (#orderId:INTEGER#, #orderCode:VARCHAR#, #orderName:VARCHAR#, #orderDesc:VARCHAR#,
      #orderRunStatus:VARCHAR#, #orderGoodsCount:VARCHAR#, #orderPrice:VARCHAR#,
      #createUserCode:VARCHAR#, #modifyUserCode:VARCHAR#, #createTime:TIMESTAMP#,
      #modifyTime:TIMESTAMP#)
  </insert>
  <update id="abatorgenerated_updateByPrimaryKey" parameterClass="app.cn.qtt.bm.model.TOrderInfo" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Sat Jun 08 15:02:10 CST 2013.
    -->
    update t_order_info
    set order_code = #orderCode:VARCHAR#,
      order_name = #orderName:VARCHAR#,
      order_desc = #orderDesc:VARCHAR#,
      order_run_status = #orderRunStatus:VARCHAR#,
      order_goods_count = #orderGoodsCount:VARCHAR#,
      order_price = #orderPrice:VARCHAR#,
      create_user_code = #createUserCode:VARCHAR#,
      modify_user_code = #modifyUserCode:VARCHAR#,
      create_time = #createTime:TIMESTAMP#,
      modify_time = #modifyTime:TIMESTAMP#
    where order_id = #orderId:INTEGER#
  </update>
  <update id="abatorgenerated_updateByPrimaryKeySelective" parameterClass="app.cn.qtt.bm.model.TOrderInfo" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Sat Jun 08 15:02:10 CST 2013.
    -->
    update t_order_info
    <dynamic prepend="set" >
      <isNotNull prepend="," property="orderCode" >
        order_code = #orderCode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="orderName" >
        order_name = #orderName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="orderDesc" >
        order_desc = #orderDesc:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="orderRunStatus" >
        order_run_status = #orderRunStatus:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="orderGoodsCount" >
        order_goods_count = #orderGoodsCount:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="orderPrice" >
        order_price = #orderPrice:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="createUserCode" >
        create_user_code = #createUserCode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="modifyUserCode" >
        modify_user_code = #modifyUserCode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="createTime" >
        create_time = #createTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="modifyTime" >
        modify_time = #modifyTime:TIMESTAMP#
      </isNotNull>
    </dynamic>
    where order_id = #orderId:INTEGER#
  </update>
  <select id="abatorgenerated_countByExample" parameterClass="app.cn.qtt.bm.model.TOrderInfoExample" resultClass="java.lang.Integer" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Sat Jun 08 15:02:10 CST 2013.
    -->
    select count(*) from t_order_info
    <include refid="t_order_info.abatorgenerated_Example_Where_Clause" />
  </select>
  <update id="abatorgenerated_updateByExampleSelective" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Sat Jun 08 15:02:10 CST 2013.
    -->
    update t_order_info
    <dynamic prepend="set" >
      <isNotNull prepend="," property="record.orderId" >
        order_id = #record.orderId:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="record.orderCode" >
        order_code = #record.orderCode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.orderName" >
        order_name = #record.orderName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.orderDesc" >
        order_desc = #record.orderDesc:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.orderRunStatus" >
        order_run_status = #record.orderRunStatus:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.orderGoodsCount" >
        order_goods_count = #record.orderGoodsCount:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.orderPrice" >
        order_price = #record.orderPrice:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.createUserCode" >
        create_user_code = #record.createUserCode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.modifyUserCode" >
        modify_user_code = #record.modifyUserCode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.createTime" >
        create_time = #record.createTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="record.modifyTime" >
        modify_time = #record.modifyTime:TIMESTAMP#
      </isNotNull>
    </dynamic>
    <isParameterPresent >
      <include refid="t_order_info.abatorgenerated_Example_Where_Clause" />
    </isParameterPresent>
  </update>
  <update id="abatorgenerated_updateByExample" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
      This element was generated on Sat Jun 08 15:02:10 CST 2013.
    -->
    update t_order_info
    set order_id = #record.orderId:INTEGER#,
      order_code = #record.orderCode:VARCHAR#,
      order_name = #record.orderName:VARCHAR#,
      order_desc = #record.orderDesc:VARCHAR#,
      order_run_status = #record.orderRunStatus:VARCHAR#,
      order_goods_count = #record.orderGoodsCount:VARCHAR#,
      order_price = #record.orderPrice:VARCHAR#,
      create_user_code = #record.createUserCode:VARCHAR#,
      modify_user_code = #record.modifyUserCode:VARCHAR#,
      create_time = #record.createTime:TIMESTAMP#,
      modify_time = #record.modifyTime:TIMESTAMP#
    <isParameterPresent >
      <include refid="t_order_info.abatorgenerated_Example_Where_Clause" />
    </isParameterPresent>
  </update>
  
  <select id="selectOrderOperateDetail" resultMap="OrderOperateBeanResult" parameterClass="java.util.Map" >
    select c.shop_name,e.shop_goods_name,b.shop_goods_count,d.user_name,a.create_time,a.modify_time,'已领取' paid_status,
    (SELECT count(1) FROM t_log_user_access a WHERE a.user_log_time >=#currentTime:VARCHAR# AND a.user_oprate_uri = '/BespeakMeal/order/get-order' 
    AND a.user_oprate_parame  LIKE CONCAT('tel=',d.user_phone_number,'%')) operate_times ,d.user_phone_number,d.department FROM t_order_info a,
    t_order_info_goods b,t_shop_info c,
    t_sys_user_info d,t_shop_goods e
    where a.order_id = b.order_id
    and c.shop_id = b.shop_id
    and d.user_code = a.create_user_code
    and a.create_time >= #currentTime:VARCHAR#
    and a.order_run_status = '04'
    AND e.shop_goods_id = b.shop_goods_id
    UNION
    select c.shop_name,e.shop_goods_name,b.shop_goods_count,d.user_name,a.create_time,a.modify_time,'未领取' paid_status,
    (SELECT count(1) FROM t_log_user_access a WHERE a.user_log_time >=#currentTime:VARCHAR# AND a.user_oprate_uri = '/BespeakMeal/order/get-order' 
    AND a.user_oprate_parame  LIKE CONCAT('tel=',d.user_phone_number,'%')) operate_times ,d.user_phone_number,d.department from t_order_info a,
    t_order_info_goods b,t_shop_info c,
    t_sys_user_info d,t_shop_goods e
    where a.order_id = b.order_id
    and c.shop_id = b.shop_id
    and d.user_code = a.create_user_code
    and a.create_time >=#currentTime:VARCHAR#
    and order_run_status NOT IN  ('00','04')
    AND e.shop_goods_id = b.shop_goods_id;
    
  </select>
  
  
  <select id="selectInvalideUserOrderOperateDetail" resultMap="OrderOperateBeanResult" parameterClass="java.util.Map" >
    select c.shop_name,e.shop_goods_name,b.shop_goods_count,d.user_name,a.create_time,a.modify_time,'未领取' paid_status,
    (SELECT count(1) FROM t_log_user_access a WHERE a.user_log_time >=#currentTime:VARCHAR# AND a.user_oprate_uri = '/BespeakMeal/order/get-order' 
    AND a.user_oprate_parame  LIKE CONCAT('tel=',d.user_phone_number,'%')) operate_times,d.user_phone_number,d.department from t_order_info a,
    t_order_info_goods b,t_shop_info c,
    t_sys_user_info d,t_shop_goods e
    where a.order_id = b.order_id
    and c.shop_id = b.shop_id
    and d.user_code = a.create_user_code
    and to_days(a.create_time) =to_days(#currentTime:VARCHAR#)
    and d.user_status = '01'
	and d.user_type = '01'
    and order_run_status NOT IN  ('00','04','05')
    AND e.shop_goods_id = b.shop_goods_id;
    
  </select>
  
</sqlMap>